<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="hospital.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="0"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="1501"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="4" parent="0"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="doctors" custom_title="0" dock_id="1" table="4,7:maindoctors"/><dock_state state="000000ff00000000fd0000000100000002000006b4000003c0fc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000000006b40000011100ffffff000002870000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="appointments" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="94"/><column index="2" value="62"/><column index="3" value="59"/><column index="4" value="106"/><column index="5" value="107"/><column index="6" value="115"/><column index="7" value="163"/><column index="8" value="234"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="doctors" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="69"/><column index="2" value="93"/><column index="3" value="78"/><column index="4" value="148"/><column index="5" value="187"/><column index="6" value="70"/><column index="7" value="99"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="Hospital.db">-- ============================================================================

-- QUERY 1: Doctor Workload Analysis

-- ============================================================================



SELECT 

    d.DoctorID,

    d.FirstName || ' ' || d.LastName AS DoctorName,

    d.Specialty,

    dept.DepartmentName,

    COUNT(DISTINCT p.PatientID) AS TotalPatients,

    COUNT(DISTINCT a.AppointmentID) AS TotalAppointments,

    ROUND(AVG(b.TotalAmount), 2) AS AvgBilling,

    SUM(b.TotalAmount) AS TotalRevenue

FROM doctors d

LEFT JOIN departments dept ON d.DepartmentID = dept.DepartmentID

LEFT JOIN patients p ON d.DoctorID = p.DoctorID

LEFT JOIN appointments a ON d.DoctorID = a.DoctorID

LEFT JOIN billing b ON a.AppointmentID = b.AppointmentID

GROUP BY d.DoctorID, d.FirstName, d.LastName, d.Specialty, dept.DepartmentName

ORDER BY TotalRevenue DESC;





-- ============================================================================

-- QUERY 2: Patient Status Distribution

-- ============================================================================



SELECT 

    p.PatientStatus,

    COUNT(DISTINCT p.PatientID) AS NumPatients,

    ROUND(COUNT(DISTINCT p.PatientID) * 100.0 / 

          SUM(COUNT(DISTINCT p.PatientID)) OVER (), 2) AS PercentageOfTotal,

    COUNT(DISTINCT a.AppointmentID) AS TotalAppointments,

    ROUND(CAST(COUNT(DISTINCT a.AppointmentID) AS FLOAT) / 

          COUNT(DISTINCT p.PatientID), 2) AS AvgAppointmentsPerPatient,

    SUM(CASE WHEN a.AppointmentStatus = 'Completed' THEN 1 ELSE 0 END) AS CompletedAppointments,

    SUM(CASE WHEN a.AppointmentStatus = 'Cancelled' THEN 1 ELSE 0 END) AS CancelledAppointments

FROM patients p

LEFT JOIN appointments a ON p.PatientID = a.PatientID

GROUP BY p.PatientStatus

ORDER BY NumPatients DESC;





-- ============================================================================

-- QUERY 3: Department Financial Performance

-- ============================================================================



WITH DepartmentMetrics AS (

    SELECT 

        dept.DepartmentName,

        dept.DepartmentHead,

        COUNT(DISTINCT d.DoctorID) AS NumDoctors,

        COUNT(DISTINCT a.AppointmentID) AS TotalAppointments,

        SUM(b.TotalAmount) AS TotalRevenue,

        ROUND(AVG(b.TotalAmount), 2) AS AvgRevenuePerAppointment,

        SUM(CASE WHEN b.PaymentStatus = 'Paid' THEN b.TotalAmount ELSE 0 END) AS CollectedRevenue

    FROM departments dept

    LEFT JOIN doctors d ON dept.DepartmentID = d.DepartmentID

    LEFT JOIN appointments a ON d.DoctorID = a.DoctorID

    LEFT JOIN billing b ON a.AppointmentID = b.AppointmentID

    GROUP BY dept.DepartmentName, dept.DepartmentHead

)

SELECT 

    DepartmentName,

    DepartmentHead,

    NumDoctors,

    TotalAppointments,

    TotalRevenue,

    AvgRevenuePerAppointment,

    CollectedRevenue,

    ROUND(CollectedRevenue * 100.0 / NULLIF(TotalRevenue, 0), 2) AS CollectionRate

FROM DepartmentMetrics

WHERE TotalRevenue &gt; 0

ORDER BY TotalRevenue DESC;





-- ============================================================================

-- QUERY 4: High-Value Patients

-- ============================================================================



SELECT 

    p.PatientID,

    p.FirstName || ' ' || p.LastName AS PatientName,

    p.PatientStatus,

    d.FirstName || ' ' || d.LastName AS AssignedDoctor,

    d.Specialty,

    COUNT(DISTINCT a.AppointmentID) AS TotalAppointments,

    COUNT(DISTINCT t.TreatmentID) AS TotalTreatments,

    SUM(b.TotalAmount) AS TotalSpending,

    ROUND(AVG(b.TotalAmount), 2) AS AvgSpendingPerVisit,

    MIN(a.AppointmentDate) AS FirstVisit,

    MAX(a.AppointmentDate) AS LastVisit

FROM patients p

LEFT JOIN doctors d ON p.DoctorID = d.DoctorID

LEFT JOIN appointments a ON p.PatientID = a.PatientID

LEFT JOIN treatments t ON a.AppointmentID = t.AppointmentID

LEFT JOIN billing b ON a.AppointmentID = b.AppointmentID

GROUP BY p.PatientID, p.FirstName, p.LastName, p.PatientStatus, 

         d.FirstName, d.LastName, d.Specialty

HAVING SUM(b.TotalAmount) &gt; 0

ORDER BY TotalSpending DESC

LIMIT 15;</sql><current_tab id="0"/></tab_sql></sqlb_project>
